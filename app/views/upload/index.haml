!!! 5

%html
  %head
    %title
      Upload
    = stylesheet_link_tag("style")
    = javascript_include_tag("application")
    %script{:type=>"text/javascript", :src=>"http://maps.google.com/maps/api/js?sensor=true"}
    %script{:type=>"text/javascript", :src=>"https://raw.github.com/HPNeo/gmaps/master/gmaps.js"}
    %script{:type=>"text/javascript", :src=>"http://hpneo.github.com/gmaps/prettify/prettify.js"}
    %link{:href=>"http://fonts.googleapis.com/css?family=Convergence|Bitter|Droid+Sans|Ubuntu+Mono", :rel=>"stylesheet", :type=>"text/css"}
    %link{:href=>"http://hpneo.github.com/gmaps/prettify/prettify.css", :rel=>"stylesheet", :type=>"text/css"}
  %body
    .blackout
    .container
      = render :partial => "partial/topbar", :locals => {:user => @user}
      %div.span12
        %h3
          Upload a Landskape
      = form_for Photo.new, :html=>{:multipart => true} do |f|
        %div.span5#upload-left{:style => "float:left;"}
          #upload-box
            #drag-and-drop
              %span{:style=>"position:relative;top:80px;left:35px;font-size:1.2em;width:200px;"}
                Drag and drop your landskape here!
            #file-browse
              -#%input{:type=>"file", :name => "uploaded_file", :style=>"margin-bottom:10px;"}
              = f.file_field :photo
              .clear
        %div.span4#upload-right{:style => "float:left;"}
          %input{:type=>"hidden", :id=>"latitude", :name=>"latitude"}
          %input{:type=>"hidden", :id=>"longitude", :name=>"longitude"}
          = f.label :Title
          = f.text_field :title
          = f.label :Description
          = f.text_field :description

          = f.label :City
          = f.text_field :city
          = f.label :State
          = f.text_field :state
          %br
          %button.btn#fake_submit
            Upload
          = f.submit :Upload, :class => "btn btn-warning", :id=>"true_submit"
      %div#select-location
        %form{:method=>"post", :id=>"geocoding_form"}
          %h4
            Pinpoint a Location:
          %div.input
            %input#address{:type=>"text", :name=>"address"}
            %button.btn#button{:type=>"submit"}
              %i.icon-search
            .clear
        %div.popin
          %div#map
        %button.btn#fake_submit2
          Upload

        .clear
    :javascript
      $(document).ready(function(){
        $tr = $("#true_submit");
        $tr.css('visibility','hidden');
        lat = 0;
        lon = 0;
        prettyPrint();
        map = new GMaps({
          div: '#map',
          lat: -12.043333,
          lng: -77.028333
        });
        map.addListener('click', function(event) {
          map.removeMarkers();
          marker = map.addMarker({
            lat: event.latLng.lat(),
            lng: event.latLng.lng(),
            title: "asdf",
            infoWindow: {
              content: "<p> HTML content</p>"
            }
          });
          lat = event.latLng.lat();
          lon = event.latLng.lng();
        });
        $('#geocoding_form').submit(function(e){
          e.preventDefault();
          GMaps.geocode({
            address: $('#address').val().trim(),
            callback: function(results, status){
              if(status=='OK'){
                var latlng = results[0].geometry.location;
                map.setCenter(latlng.lat(), latlng.lng());
                map.addMarker({
                  lat: latlng.lat(),
                  lng: latlng.lng()
                });
              }
            }
          });
        });
        $("#fake_submit").click(function(e) {
          e.preventDefault();
          $("#select-location").css('visibility','visible');
          $(".blackout").css('visibility','visible');
        });
        $("#fake_submit2").click(function(e) {
          $("#latitude").val(lat);
          $("#longitude").val(lon);
          console.log(lat);
          console.log($("#latitude"));
          console.log(lon);
          console.log($("#longitude"));
          $("#true_submit").click();
        });
      });
